let canvas,canvasContext,framesPerSecond=90;const BACKGROUND_COLOR="black";let paddle,balls=[],numBalls=1,level=1,score=0,angle=.1,rewardScore=0,showingWinScreen=!1,showingLoseScreen=!1,paused=!0,started_yet=!1;const NUMBER_OF_LIVES=3;let lives=3,bricks=[];const BRICK_WIDTH=60,BRICK_WIDTH_PADDING=8,BRICK_HEIGHT_PADDING=7,BRICK_HEIGHT=20;let centerScreenX,centerScreenY,clientRectLeft,brick_rows=6,brick_columns=7,lowestBrick=0,distanceFromRight=300,leftButtonX=0,buttonY=0,rightButtonX=0;function setup(){canvas=document.getElementById("gameCanvas"),paddle=new Paddle;let e=getViewportDimension();e.w<=767?canvas.width=e.w-40:canvas.width=e.w-60,canvas.height=e.h-220,canvasContext=canvas.getContext("2d"),centerScreenX=canvas.width/2,centerScreenY=canvas.height/2,paddle.pos.x=centerScreenX-paddle.halfWidth,paddle.pos.y=canvas.height-paddle.padding-paddle.height,brick_columns=Math.floor(canvas.width/(BRICK_WIDTH+BRICK_WIDTH_PADDING)),brick_rows=Math.floor(canvas.height/(BRICK_HEIGHT+BRICK_HEIGHT_PADDING)/3),lowestBrick=brick_rows*(BRICK_HEIGHT+BRICK_HEIGHT_PADDING)+BRICK_HEIGHT+20,createBalls(),createBricks(),rewardScore=1e3*level}function moveEverything(){if(!(showingWinScreen||showingLoseScreen||paused)){checkForWin();for(let e=0;e<balls.length;e++){let t=balls[e];t.move(),t.checkForBrickHit(),t.checkForPaddleHit(),t.checkForBoarderHit(),t.checkForBottomScreenHit()&&(balls.splice(e,1),t=void 0)}0===balls.length&&(lives--,showingLoseScreen=!0)}}function drawEverything(){colorRect(0,0,canvas.width,canvas.height,"black"),setText("white"),canvasContext.fillText("Level: "+level+" -  Lives: "+lives,canvas.width-distanceFromRight,25),canvasContext.fillText("Score: "+score,5,25);for(let e=0;e<bricks.length;e++)bricks[e].draw();if(showingWinScreen)return setText("white"),started_yet=!1,canvasContext.fillText("Next Level!",centerScreenX-60,centerScreenY),void canvasContext.fillText("Click to Continue",centerScreenX-90,centerScreenY+50);if(showingLoseScreen)return setText("white"),started_yet=!1,0===lives?canvasContext.fillText("You lose... Score: "+score,centerScreenX-90,centerScreenY+20):canvasContext.fillText(lives+" More Li"+(lives%2==0?"ves":"fe")+"!",centerScreenX-90,centerScreenY+20),void canvasContext.fillText("Click to Continue",centerScreenX-90,centerScreenY+70);paddle.draw();for(let e of balls)e.draw();paused&&(started_yet?canvasContext.fillText("Paused",centerScreenX-30,centerScreenY+50):canvasContext.fillText("Click/Tap to Start/Pause!",centerScreenX-100,centerScreenY+50))}function checkForWin(){showingWinScreen=0===bricks.length}function handleClick(e){if(showingWinScreen){level%2==0&&0!==lives&&lives++,level++,rewardScore=1e3*level,showingWinScreen=!1,paused=!0;for(let e of balls)e.reset();createBricks(),createBalls()}else if(showingLoseScreen){if(showingLoseScreen=!1,paused=!0,createBalls(),0===lives){started_yet=!1,level=1,score=0,rewardScore=1e3*level,lives=3;for(let e of balls)e.reset();createBricks()}}else paused=!paused,started_yet=!0}function getViewportDimension(){let e=window,t="inner";return"innerWidth"in window||(t="client",e=document.documentElement||document.body),{w:e[t+"Width"],h:e[t+"Height"]}}function constrain(e,t,s){return Math.max(Math.min(e,s),t)}function setText(e){canvasContext.fillStyle=e,canvas.width>=556?(canvasContext.font="30px Roboto",distanceFromRight=300):(canvasContext.font="22px Roboto",distanceFromRight=200)}function getRandomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}function colorRect(e,t,s,i,n){canvasContext.fillStyle=n,canvasContext.fillRect(e,t,s,i)}function createBricks(){bricks=[];let e=(canvas.width-brick_columns*(BRICK_WIDTH+BRICK_WIDTH_PADDING)+BRICK_WIDTH_PADDING)/2,t=getRandomInt(0,360),s=getRandomInt(0,1)?-20:20;for(let i=1;i<=brick_rows;i++){let n="hsl("+t+", 100%, 50%)";for(let t=0;t<brick_columns;t++)bricks.push(new Brick(t*(BRICK_WIDTH+BRICK_WIDTH_PADDING)+e,i*(BRICK_HEIGHT+BRICK_HEIGHT_PADDING)+10,n));(t+s>360||t+s<0)&&(s*=-1),t+=s}}function createBalls(){for(let e=0;e<numBalls;e++)createNewBall()}function createNewBall(){let e=new Ball;e.reset(),balls.push(e)}window.onload=function(){setup();let e=canvas.getBoundingClientRect().left-document.documentElement.scrollLeft;setInterval((function(){moveEverything(),drawEverything()}),1e3/framesPerSecond),canvas.addEventListener("mousemove",(function(t){paddle.pos.x=t.clientX-e-paddle.halfWidth})),canvas.addEventListener("click",handleClick),canvas.addEventListener("touchmove",(function(e){e.stopPropagation(),e.preventDefault();var t=new MouseEvent("mousemove",{bubbles:!0,cancelable:!0,view:window,detail:e.detail,screenX:e.touches[0].screenX,screenY:e.touches[0].screenY,clientX:e.touches[0].clientX,clientY:e.touches[0].clientY});canvas.dispatchEvent(t)}),!1)};class Vector{constructor(e,t){this.x=e||0,this.y=t||0}toString(){return"x:"+this.x+", y:"+this.y}}class Brick{constructor(e,t,s){this.pos=new Vector(e,t),this.color=s}draw(){colorRect(this.pos.x,this.pos.y,BRICK_WIDTH,BRICK_HEIGHT,this.color)}hit(){score+=10*level,score>=rewardScore&&(rewardScore+=rewardScore,createNewBall()),bricks=bricks.filter((function(e){return this!==e}),this)}}class Paddle{constructor(){this.pos=new Vector(0,0),this.width=100,this.height=10,this.padding=10,this.halfWidth=this.width/2}draw(){colorRect(this.pos.x,this.pos.y,this.width,this.height,"white")}}class Ball{constructor(){this.pos=new Vector,this.vel=new Vector,this.radius=10,this.colorControl=0,this.color="",this.setBallBoarder()}setBallBoarder(){this.top=this.pos.y-this.radius,this.bottom=this.pos.y+this.radius,this.left=this.pos.x-this.radius,this.right=this.pos.x+this.radius}draw(){this.colorControl%(framesPerSecond/5)==0&&(this.color="hsl("+getRandomInt(0,360)+", 100%, 50%)",this.colorControl=0),this.colorControl++,canvasContext.fillStyle=this.color,canvasContext.beginPath(),canvasContext.arc(this.pos.x,this.pos.y,this.radius,0,2*Math.PI,!0),canvasContext.fill()}move(){0===this.vel.x&&this.vel.x--,0===this.vel.y&&this.vel.y--;let e=Math.hypot(this.vel.x,this.vel.y);this.pos.x=this.pos.x+constrain(this.vel.x/e*4,-4,4),this.pos.y=this.pos.y+constrain(this.vel.y/e*4,-4,4),this.setBallBoarder()}reset(){this.vel.x=getRandomInt(-2,2),this.vel.y=getRandomInt(-3,-4)-level,this.pos.x=centerScreenX-this.radius,this.pos.y=canvas.height-paddle.padding-paddle.height-this.radius-10}checkForBrickHit(){if(this.top>lowestBrick)return!1;for(let e of bricks)if(this.right>=e.pos.x&&this.left<=e.pos.x+BRICK_WIDTH&&this.bottom>=e.pos.y&&this.top<=e.pos.y+BRICK_HEIGHT){e.hit();let t=Math.abs(this.right-e.pos.x),s=Math.abs(this.left-(e.pos.x+BRICK_WIDTH)),i=Math.abs(this.bottom-e.pos.y),n=Math.abs(this.top-(e.pos.y+BRICK_HEIGHT)),o=Math.min(t,s,i,n);return o===i?this.vel.y=-Math.abs(this.vel.y):o===n?this.vel.y=Math.abs(this.vel.y):this.vel.x=o===t?-Math.abs(this.vel.x):Math.abs(this.vel.x),e=void 0,!0}return!1}checkForPaddleHit(){if(this.right>=paddle.pos.x&&this.left<=paddle.pos.x+paddle.width&&this.bottom>=paddle.pos.y-paddle.height/2){this.vel.y=-Math.abs(this.vel.y);let e=this.pos.x-(paddle.pos.x+paddle.halfWidth-paddle.halfWidth/6);return this.vel.x=Math.round(e*angle),!0}return!1}checkForBottomScreenHit(){return this.bottom>=canvas.height}checkForBoarderHit(){return this.top<=0?(this.vel.y=Math.abs(this.vel.y),!0):this.right>=canvas.width?(this.vel.x=-Math.abs(this.vel.x),!0):this.left<=0&&(this.vel.x=Math.abs(this.vel.x),!0)}}